<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Résultats de Recherche</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Résultats des : <span th:text="${typeRecherche}"></span> pour l'année : <span th:text="${anneeRecherchee}"></span></h1>
    <table class="table table-striped table-bordered">
        <thead class="table-success">
        <tr>
            <th>Numéro</th>
            <th>Cote</th>
            <th>Titre</th>
            <th>Étudiant</th>
            <th>Encadrant</th>
            <th>Filière</th>
            <th>Année</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="memoire, iterStat : ${resultats}">
            <td th:text="${iterStat.index + 1}"></td>
            <td th:text="${memoire.cote}"></td>
            <td th:text="${memoire.titre}"></td>
            <td th:text="${memoire.etudiant != null ? memoire.etudiant.nom + ' ' + memoire.etudiant.prenom : 'Non défini'}"></td>
            <td th:text="${memoire.encadrant != null ? memoire.encadrant.nom + ' ' + memoire.encadrant.prenom : 'Non défini'}"></td>
            <td th:text="${memoire.filiere != null ? memoire.filiere.nom : 'Non défini'}"></td>
            <td th:text="${memoire.annee}"></td>
        </tr>
        </tbody>
    </table>

    <div class="text-end">
        <button class="btn btn-primary me-2" onclick="imprimer()">Imprimer</button>
        <button class="btn btn-success" onclick="telechargerCSV()">Télécharger</button>
        <a href="/memoires/liste" class="btn btn-secondary">Retour</a>
    </div>
</div>

<script>
    function imprimer() {
        window.print();
    }

    function telechargerCSV() {
        const rows = [
            ["Numéro", "Cote", "Titre", "Étudiant", "Encadrant", "Filière", "Année"],
            ...Array.from(document.querySelectorAll("table tbody tr")).map(row =>
                Array.from(row.querySelectorAll("td")).map(cell => cell.textContent.trim()))
        ];

        let csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", "resultats_recherche.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
